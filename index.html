<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trading Beyond Borders</title>
  
  <!-- Vega-Lite Dependencies for Interactive Visualizations -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  
  <style>
    /* ========================================
       GLOBAL STYLES & RESET
       ======================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* ========================================
       BACKGROUND - Changed to warm cream/camel tone
       Original: Blue gradient (#1e3c72 to #c9d6df)
       New: Warm cream/camel gradient
       ======================================== */
    body {
      /* Warm cream to light brown gradient for a professional, inviting look */
      background: linear-gradient(135deg, #c9a77c 0%, #d4b896 25%, #e8d5b7 50%, #f0e6d2 75%, #f5f0e8 100%);
      background-attachment: fixed;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* Subtle overlay pattern for depth - adjusted opacity for cream background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(139, 101, 66, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(139, 101, 66, 0.06) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(139, 101, 66, 0.04) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }
    
    /* ========================================
       MAIN CONTAINER
       ======================================== */
    .container {
      max-width: 1300px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 20px;
      overflow: hidden;
      /* Enhanced shadow for better contrast against cream background */
      box-shadow: 0 20px 60px rgba(139, 101, 66, 0.3);
      position: relative;
      z-index: 1;
    }
    
    /* ========================================
       HEADER SECTION - Changed to complement cream theme
       Original: Blue gradient (#1e3c72 to #2a5298)
       New: Rich brown gradient
       ======================================== */
    .header {
      /* Warm brown gradient matching the cream theme */
      background: linear-gradient(135deg, #8b6542 0%, #a67c52 100%);
      padding: 50px 40px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    /* Animated shine effect for visual interest */
    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 200%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
      animation: shine 3s infinite;
    }

    @keyframes shine {
      0% { left: -100%; }
      50%, 100% { left: 100%; }
    }
    
    .header h1 {
      font-size: 48px;
      font-weight: bold;
      margin: 0 0 15px 0;
      color: #fff;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
      position: relative;
      z-index: 1;
    }
    
    .header h2 {
      font-size: 22px;
      font-weight: normal;
      margin: 10px 0;
      color: #f5f0e8;
      position: relative;
      z-index: 1;
    }
    
    .header p {
      margin: 20px 0 0 0;
      font-size: 16px;
      color: #e8d5b7;
      position: relative;
      z-index: 1;
    }
    
    /* ========================================
       CONTROLS SECTION - Updated to match cream theme
       Original: Blue tones (#e3f2fd to #bbdefb)
       New: Light cream tones
       ======================================== */
    .controls {
      /* Light cream gradient for controls bar */
      background: linear-gradient(to right, #f5f0e8, #e8d5b7);
      padding: 30px 40px;
      /* Border color changed from blue to brown */
      border-bottom: 3px solid #c9a77c;
    }
    
    .control-group {
      display: flex;
      align-items: center;
      gap: 50px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    /* Individual control items with hover effects */
    .control-item {
      display: flex;
      align-items: center;
      gap: 15px;
      background: white;
      padding: 15px 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(139, 101, 66, 0.15);
      transition: transform 0.2s;
    }

    .control-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(139, 101, 66, 0.25);
    }
    
    .control-item label {
      font-weight: 600;
      font-size: 15px;
      /* Changed label color from blue to brown */
      color: #8b6542;
    }
    
    /* ========================================
       RANGE SLIDER STYLING - Updated to brown theme
       Original: Blue gradient (#1e88e5 to #42a5f5)
       New: Brown gradient
       ======================================== */
    .control-item input[type="range"] {
      width: 350px;
      height: 8px;
      border-radius: 5px;
      /* Brown gradient for slider track */
      background: linear-gradient(to right, #a67c52, #c9a77c);
      outline: none;
      -webkit-appearance: none;
    }

    /* Slider thumb for WebKit browsers (Chrome, Safari) */
    .control-item input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #a67c52;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      transition: all 0.3s;
    }

    .control-item input[type="range"]::-webkit-slider-thumb:hover {
      background: #8b6542;
      transform: scale(1.1);
    }

    /* Slider thumb for Firefox */
    .control-item input[type="range"]::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #a67c52;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      border: none;
      transition: all 0.3s;
    }

    .control-item input[type="range"]::-moz-range-thumb:hover {
      background: #8b6542;
      transform: scale(1.1);
    }
    
    /* Dropdown select styling - updated to brown theme */
    .control-item select {
      padding: 10px 20px;
      font-size: 15px;
      /* Border color changed from blue to brown */
      border: 2px solid #a67c52;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      font-weight: 500;
      color: #8b6542;
      transition: all 0.3s;
    }

    .control-item select:hover {
      border-color: #8b6542;
      background: #f5f0e8;
    }
    
    /* Year display styling - changed from blue to brown */
    .year-display {
      font-size: 20px;
      font-weight: bold;
      color: #a67c52;
      min-width: 50px;
      text-align: center;
    }
    
    /* ========================================
       CONTENT SECTIONS
       ======================================== */
    .section {
      padding: 50px 40px;
      background: white;
    }
    
    /* Alternate section with subtle gradient */
    .section-alt {
      background: linear-gradient(to bottom, #fafafa, #ffffff);
    }
    
    /* Section title with accent border - changed from blue to brown */
    .section-title {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 30px;
      color: #8b6542;
      border-left: 5px solid #a67c52;
      padding-left: 20px;
    }
    
    /* ========================================
       VISUALIZATION CONTAINERS
       Properly centered and sized for optimal display
       ======================================== */
    .viz-box {
      background: #ffffff;
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 25px;
      box-shadow: 0 4px 20px rgba(139, 101, 66, 0.08);
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    /* Ensure visualizations are centered within their containers */
    #export-map, #trade-chart {
      width: 100%;
      display: flex;
      justify-content: center;
    }
    
    /* ========================================
       CAPTION BOXES - Updated to cream/brown theme
       Original: Blue gradient (#e3f2fd to #bbdefb)
       New: Cream gradient
       ======================================== */
    .caption {
      background: linear-gradient(135deg, #f5f0e8 0%, #e8d5b7 100%);
      border-left: 5px solid #a67c52;
      padding: 25px;
      margin-top: 25px;
      line-height: 1.8;
      color: #5c4530;
      border-radius: 8px;
      font-size: 15px;
    }

    /* Insight boxes remain green for distinction */
    .insight-box {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      border-left: 5px solid #43a047;
      padding: 25px;
      margin-top: 25px;
      line-height: 1.8;
      color: #1b5e20;
      border-radius: 8px;
      font-size: 15px;
    }

    .insight-box strong {
      color: #2e7d32;
    }
    
    /* ========================================
       FOOTER - Changed to match header brown theme
       Original: Blue gradient
       New: Brown gradient
       ======================================== */
    .footer {
      background: linear-gradient(135deg, #8b6542 0%, #a67c52 100%);
      padding: 30px;
      text-align: center;
      font-size: 14px;
      color: #f5f0e8;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- ========================================
         HEADER SECTION
         Contains title, subtitle, and author info
         ======================================== -->
    <div class="header">
      <h1>Trading Beyond Borders</h1>
      <h2>FIT3179 Week 10 Homework – Australia's Trade Network (2014-2024)</h2>
      <p><strong>Author:</strong> Shlok Trivedi | <strong>Student ID:</strong> 33639191</p>
    </div>

    <!-- ========================================
         CONTROLS SECTION
         Interactive year slider and trade direction selector
         Both controls update both visualizations simultaneously
         ======================================== -->
    <div class="controls">
      <div class="control-group">
        <!-- Year Slider: Controls which year's data is displayed on the map -->
        <div class="control-item">
          <label for="yearSlider">Select Year:</label>
          <input type="range" id="yearSlider" min="2014" max="2024" value="2024" step="1">
          <span class="year-display" id="yearDisplay">2024</span>
        </div>
        
        <!-- Trade Direction Selector: Switches between Exports and Imports -->
        <!-- Also changes color scheme: RED for Exports, BLUE for Imports -->
        <div class="control-item">
          <label for="tradeSelect">Trade Direction:</label>
          <select id="tradeSelect">
            <option value="Exports">Exports (AUS → World)</option>
            <option value="Imports">Imports (World → AUS)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- ========================================
         CHOROPLETH MAP SECTION
         Interactive world map showing trade values by country
         ======================================== -->
    <div class="section">
      <div class="section-title">Interactive Trade Map</div>
      
      <div class="viz-box">
        <div id="export-map"></div>
      </div>
      
      <!-- Descriptive caption explaining the map -->
      <div class="caption">
        This choropleth map visualizes Australia's trade relationships with all its major trading partners from 2014 to 2024. Use the year slider to explore how trade patterns have evolved over the decade. The trade direction selector allows you to switch between viewing Australian exports to these countries versus imports from them. The color scheme changes based on trade direction: red tones for exports and blue tones for imports. Darker shades indicate higher trade values.
      </div>

      <!-- Key insights about the data -->
      <div class="insight-box">
        <strong>Key Insights:</strong> China dominates as Australia's largest trading partner, with trade values reaching AUD 200 billion in exports and AUD 158 billion in imports by 2024. The Asia-Pacific region represents the majority of Australia's trading partners, highlighting deep economic integration with Asian markets. Trade with the United States and China shows the strongest growth over this period.
      </div>
    </div>

    <!-- ========================================
         LINE CHART SECTION
         Shows trade trends over time for all countries
         ======================================== -->
    <div class="section section-alt">
      <div class="section-title">Trade Trends Over Time (2014-2024)</div>
      
      <div class="viz-box">
        <div id="trade-chart"></div>
      </div>
      
      <!-- Descriptive caption explaining the line chart -->
      <div class="caption">
        This line chart displays how trade values have evolved for all of Australia's major trading partners from 2014 to 2024. Each line represents a different country, allowing you to track individual trade relationships over time. The chart automatically switches between showing export or import data based on your trade direction selection above. You can hover over any point to see specific values.
      </div>

      <!-- Key insights about trends -->
      <div class="insight-box">
        <strong>Key Insights:</strong> China shows the most dramatic growth trajectory, with exports increasing by 33% and imports by 66% over the decade. The United States demonstrates rapid import growth of 64%, primarily driven by technology and automotive sectors. Most trading relationships show steady upward trends, indicating robust and growing economic ties. India emerges as a rapidly expanding market with 45% export growth from 2014 to 2024.
      </div>
    </div>

    <!-- ========================================
         FOOTER
         Data source attribution
         ======================================== -->
    <div class="footer">
      Source: Australian Bureau of Statistics (ABS) & DFAT 2024 | Created for FIT3179 Week 10 Homework
    </div>
  </div>

  <script>
    /* ========================================
       JAVASCRIPT FOR INTERACTIVE VISUALIZATIONS
       ======================================== */
    
    // Global variables to store Vega-Lite view instances
    let mapView = null;
    let chartView = null;
    let currentTradeType = 'Exports';

    /* ========================================
       TRADE DATA (2014-2024)
       10 countries × 11 years = 110 data points
       Countries: China, Japan, South Korea, USA, India, 
                  Taiwan, Singapore, UK, New Zealand, Thailand
       ======================================== */
    const allTradeData = [
      {"Country": "China", "Year": 2014, "Exports_A$b": 150, "Imports_A$b": 95},
      {"Country": "Japan", "Year": 2014, "Exports_A$b": 60, "Imports_A$b": 40},
      {"Country": "South Korea", "Year": 2014, "Exports_A$b": 38, "Imports_A$b": 28},
      {"Country": "United States of America", "Year": 2014, "Exports_A$b": 25, "Imports_A$b": 50},
      {"Country": "India", "Year": 2014, "Exports_A$b": 22, "Imports_A$b": 15},
      {"Country": "Taiwan", "Year": 2014, "Exports_A$b": 18, "Imports_A$b": 12},
      {"Country": "Singapore", "Year": 2014, "Exports_A$b": 15, "Imports_A$b": 10},
      {"Country": "United Kingdom", "Year": 2014, "Exports_A$b": 12, "Imports_A$b": 8},
      {"Country": "New Zealand", "Year": 2014, "Exports_A$b": 10, "Imports_A$b": 7},
      {"Country": "Thailand", "Year": 2014, "Exports_A$b": 8, "Imports_A$b": 12},
      {"Country": "China", "Year": 2015, "Exports_A$b": 155, "Imports_A$b": 98},
      {"Country": "Japan", "Year": 2015, "Exports_A$b": 62, "Imports_A$b": 42},
      {"Country": "South Korea", "Year": 2015, "Exports_A$b": 40, "Imports_A$b": 29},
      {"Country": "United States of America", "Year": 2015, "Exports_A$b": 26, "Imports_A$b": 52},
      {"Country": "India", "Year": 2015, "Exports_A$b": 23, "Imports_A$b": 16},
      {"Country": "Taiwan", "Year": 2015, "Exports_A$b": 19, "Imports_A$b": 13},
      {"Country": "Singapore", "Year": 2015, "Exports_A$b": 16, "Imports_A$b": 11},
      {"Country": "United Kingdom", "Year": 2015, "Exports_A$b": 13, "Imports_A$b": 9},
      {"Country": "New Zealand", "Year": 2015, "Exports_A$b": 11, "Imports_A$b": 8},
      {"Country": "Thailand", "Year": 2015, "Exports_A$b": 9, "Imports_A$b": 13},
      {"Country": "China", "Year": 2016, "Exports_A$b": 160, "Imports_A$b": 100},
      {"Country": "Japan", "Year": 2016, "Exports_A$b": 64, "Imports_A$b": 43},
      {"Country": "South Korea", "Year": 2016, "Exports_A$b": 42, "Imports_A$b": 30},
      {"Country": "United States of America", "Year": 2016, "Exports_A$b": 27, "Imports_A$b": 53},
      {"Country": "India", "Year": 2016, "Exports_A$b": 24, "Imports_A$b": 17},
      {"Country": "Taiwan", "Year": 2016, "Exports_A$b": 20, "Imports_A$b": 14},
      {"Country": "Singapore", "Year": 2016, "Exports_A$b": 17, "Imports_A$b": 12},
      {"Country": "United Kingdom", "Year": 2016, "Exports_A$b": 14, "Imports_A$b": 10},
      {"Country": "New Zealand", "Year": 2016, "Exports_A$b": 12, "Imports_A$b": 9},
      {"Country": "Thailand", "Year": 2016, "Exports_A$b": 10, "Imports_A$b": 14},
      {"Country": "China", "Year": 2017, "Exports_A$b": 168, "Imports_A$b": 105},
      {"Country": "Japan", "Year": 2017, "Exports_A$b": 66, "Imports_A$b": 45},
      {"Country": "South Korea", "Year": 2017, "Exports_A$b": 44, "Imports_A$b": 31},
      {"Country": "United States of America", "Year": 2017, "Exports_A$b": 28, "Imports_A$b": 55},
      {"Country": "India", "Year": 2017, "Exports_A$b": 25, "Imports_A$b": 18},
      {"Country": "Taiwan", "Year": 2017, "Exports_A$b": 21, "Imports_A$b": 15},
      {"Country": "Singapore", "Year": 2017, "Exports_A$b": 18, "Imports_A$b": 13},
      {"Country": "United Kingdom", "Year": 2017, "Exports_A$b": 15, "Imports_A$b": 11},
      {"Country": "New Zealand", "Year": 2017, "Exports_A$b": 13, "Imports_A$b": 10},
      {"Country": "Thailand", "Year": 2017, "Exports_A$b": 11, "Imports_A$b": 15},
      {"Country": "China", "Year": 2018, "Exports_A$b": 175, "Imports_A$b": 110},
      {"Country": "Japan", "Year": 2018, "Exports_A$b": 68, "Imports_A$b": 47},
      {"Country": "South Korea", "Year": 2018, "Exports_A$b": 46, "Imports_A$b": 32},
      {"Country": "United States of America", "Year": 2018, "Exports_A$b": 30, "Imports_A$b": 58},
      {"Country": "India", "Year": 2018, "Exports_A$b": 27, "Imports_A$b": 19},
      {"Country": "Taiwan", "Year": 2018, "Exports_A$b": 22, "Imports_A$b": 16},
      {"Country": "Singapore", "Year": 2018, "Exports_A$b": 19, "Imports_A$b": 14},
      {"Country": "United Kingdom", "Year": 2018, "Exports_A$b": 16, "Imports_A$b": 12},
      {"Country": "New Zealand", "Year": 2018, "Exports_A$b": 13, "Imports_A$b": 10},
      {"Country": "Thailand", "Year": 2018, "Exports_A$b": 11, "Imports_A$b": 16},
      {"Country": "China", "Year": 2019, "Exports_A$b": 182, "Imports_A$b": 115},
      {"Country": "Japan", "Year": 2019, "Exports_A$b": 70, "Imports_A$b": 49},
      {"Country": "South Korea", "Year": 2019, "Exports_A$b": 47, "Imports_A$b": 33},
      {"Country": "United States of America", "Year": 2019, "Exports_A$b": 31, "Imports_A$b": 60},
      {"Country": "India", "Year": 2019, "Exports_A$b": 28, "Imports_A$b": 20},
      {"Country": "Taiwan", "Year": 2019, "Exports_A$b": 23, "Imports_A$b": 17},
      {"Country": "Singapore", "Year": 2019, "Exports_A$b": 19, "Imports_A$b": 14},
      {"Country": "United Kingdom", "Year": 2019, "Exports_A$b": 17, "Imports_A$b": 13},
      {"Country": "New Zealand", "Year": 2019, "Exports_A$b": 14, "Imports_A$b": 11},
      {"Country": "Thailand", "Year": 2019, "Exports_A$b": 11, "Imports_A$b": 17},
      {"Country": "China", "Year": 2020, "Exports_A$b": 188, "Imports_A$b": 108},
      {"Country": "Japan", "Year": 2020, "Exports_A$b": 72, "Imports_A$b": 47},
      {"Country": "South Korea", "Year": 2020, "Exports_A$b": 48, "Imports_A$b": 32},
      {"Country": "United States of America", "Year": 2020, "Exports_A$b": 32, "Imports_A$b": 57},
      {"Country": "India", "Year": 2020, "Exports_A$b": 29, "Imports_A$b": 18},
      {"Country": "Taiwan", "Year": 2020, "Exports_A$b": 24, "Imports_A$b": 16},
      {"Country": "Singapore", "Year": 2020, "Exports_A$b": 19, "Imports_A$b": 13},
      {"Country": "United Kingdom", "Year": 2020, "Exports_A$b": 17, "Imports_A$b": 12},
      {"Country": "New Zealand", "Year": 2020, "Exports_A$b": 14, "Imports_A$b": 10},
      {"Country": "Thailand", "Year": 2020, "Exports_A$b": 11, "Imports_A$b": 15},
      {"Country": "China", "Year": 2021, "Exports_A$b": 195, "Imports_A$b": 125},
      {"Country": "Japan", "Year": 2021, "Exports_A$b": 73, "Imports_A$b": 52},
      {"Country": "South Korea", "Year": 2021, "Exports_A$b": 49, "Imports_A$b": 35},
      {"Country": "United States of America", "Year": 2021, "Exports_A$b": 33, "Imports_A$b": 65},
      {"Country": "India", "Year": 2021, "Exports_A$b": 30, "Imports_A$b": 22},
      {"Country": "Taiwan", "Year": 2021, "Exports_A$b": 24, "Imports_A$b": 18},
      {"Country": "Singapore", "Year": 2021, "Exports_A$b": 20, "Imports_A$b": 15},
      {"Country": "United Kingdom", "Year": 2021, "Exports_A$b": 17, "Imports_A$b": 14},
      {"Country": "New Zealand", "Year": 2021, "Exports_A$b": 14, "Imports_A$b": 12},
      {"Country": "Thailand", "Year": 2021, "Exports_A$b": 12, "Imports_A$b": 18},
      {"Country": "China", "Year": 2022, "Exports_A$b": 198, "Imports_A$b": 140},
      {"Country": "Japan", "Year": 2022, "Exports_A$b": 74, "Imports_A$b": 58},
      {"Country": "South Korea", "Year": 2022, "Exports_A$b": 50, "Imports_A$b": 38},
      {"Country": "United States of America", "Year": 2022, "Exports_A$b": 34, "Imports_A$b": 72},
      {"Country": "India", "Year": 2022, "Exports_A$b": 31, "Imports_A$b": 25},
      {"Country": "Taiwan", "Year": 2022, "Exports_A$b": 25, "Imports_A$b": 20},
      {"Country": "Singapore", "Year": 2022, "Exports_A$b": 20, "Imports_A$b": 17},
      {"Country": "United Kingdom", "Year": 2022, "Exports_A$b": 18, "Imports_A$b": 16},
      {"Country": "New Zealand", "Year": 2022, "Exports_A$b": 15, "Imports_A$b": 13},
      {"Country": "Thailand", "Year": 2022, "Exports_A$b": 12, "Imports_A$b": 20},
      {"Country": "China", "Year": 2023, "Exports_A$b": 199, "Imports_A$b": 152},
      {"Country": "Japan", "Year": 2023, "Exports_A$b": 74, "Imports_A$b": 62},
      {"Country": "South Korea", "Year": 2023, "Exports_A$b": 50, "Imports_A$b": 42},
      {"Country": "United States of America", "Year": 2023, "Exports_A$b": 35, "Imports_A$b": 78},
      {"Country": "India", "Year": 2023, "Exports_A$b": 31, "Imports_A$b": 28},
      {"Country": "Taiwan", "Year": 2023, "Exports_A$b": 25, "Imports_A$b": 22},
      {"Country": "Singapore", "Year": 2023, "Exports_A$b": 20, "Imports_A$b": 19},
      {"Country": "United Kingdom", "Year": 2023, "Exports_A$b": 18, "Imports_A$b": 17},
      {"Country": "New Zealand", "Year": 2023, "Exports_A$b": 15, "Imports_A$b": 14},
      {"Country": "Thailand", "Year": 2023, "Exports_A$b": 12, "Imports_A$b": 22},
      {"Country": "China", "Year": 2024, "Exports_A$b": 200, "Imports_A$b": 158},
      {"Country": "Japan", "Year": 2024, "Exports_A$b": 75, "Imports_A$b": 65},
      {"Country": "South Korea", "Year": 2024, "Exports_A$b": 50, "Imports_A$b": 45},
      {"Country": "United States of America", "Year": 2024, "Exports_A$b": 35, "Imports_A$b": 82},
      {"Country": "India", "Year": 2024, "Exports_A$b": 32, "Imports_A$b": 30},
      {"Country": "Taiwan", "Year": 2024, "Exports_A$b": 25, "Imports_A$b": 24},
      {"Country": "Singapore", "Year": 2024, "Exports_A$b": 20, "Imports_A$b": 20},
      {"Country": "United Kingdom", "Year": 2024, "Exports_A$b": 18, "Imports_A$b": 18},
      {"Country": "New Zealand", "Year": 2024, "Exports_A$b": 15, "Imports_A$b": 15},
      {"Country": "Thailand", "Year": 2024, "Exports_A$b": 12, "Imports_A$b": 24}
    ];

    /* ========================================
       COLOR SCHEME FUNCTION
       Returns appropriate color scheme based on trade type
       - Exports: RED tones (reds scheme)
       - Imports: BLUE tones (blues scheme)
       ======================================== */
    function getColorScheme(tradeType) {
      return tradeType === 'Exports' ? 'reds' : 'blues';
    }

    /* ========================================
       CREATE MAP SPECIFICATION
       Generates Vega-Lite spec for the choropleth map
       
       Parameters:
       - tradeType: 'Exports' or 'Imports'
       - yearValue: Year to display (2014-2024)
       
       Features:
       - Width: 900px (optimized to fit with right-side legend)
       - Height: 500px
       - Legend: Positioned on RIGHT side, vertical orientation
       - Color scheme: Changes based on trade type
       - Data: Filtered to show only the selected year
       ======================================== */
    function createMapSpec(tradeType, yearValue) {
      return {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "width": 900,
        "height": 500,
        "title": {
          "text": "Australia's Trade Destinations (AUD$ Billion) - " + yearValue,
          "fontSize": 18,
          "fontWeight": "bold",
          "anchor": "middle"
        },
        "projection": {"type": "equalEarth"},
        "layer": [
          // Layer 1: Ocean background (light blue sphere)
          {
            "data": {"sphere": true},
            "mark": {"type": "geoshape", "fill": "#d6e6f5"}
          },
          // Layer 2: Base world map (light gray for countries without data)
          {
            "data": {
              "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
              "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
            },
            "mark": {"type": "geoshape", "fill": "#e8e8e8", "stroke": "#ffffff", "strokeWidth": 0.5}
          },
          // Layer 3: Colored countries with trade data
          {
            "data": {
              "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
              "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
            },
            "transform": [
              // Join geographic data with trade data
              {
                "lookup": "properties.NAME",
                "from": {
                  // Filter data to only the selected year
                  "data": {"values": allTradeData.filter(d => d.Year === yearValue)},
                  "key": "Country",
                  "fields": ["Exports_A$b", "Imports_A$b", "Year"]
                }
              },
              // Calculate trade value based on selected type (Exports or Imports)
              {"calculate": tradeType === 'Exports' ? "datum.Exports_A$b" : "datum.Imports_A$b", "as": "TradeValue"}
            ],
            "mark": {"type": "geoshape", "stroke": "#ffffff", "strokeWidth": 0.5},
            "encoding": {
              "color": {
                "field": "TradeValue",
                "type": "quantitative",
                "title": "Trade Value (A$ Billion)",
                // Scale domain: 0 to 210 billion AUD
                "scale": {"domain": [0, 210], "scheme": getColorScheme(tradeType)},
                // LEGEND POSITION: Right side, vertical gradient
                "legend": {
                  "orient": "right",
                  "gradientLength": 250,
                  "titleLimit": 150,
                  "offset": 5
                }
              },
              // Tooltip shows country name and both export/import values
              "tooltip": [
                {"field": "properties.NAME", "title": "Country", "type": "nominal"},
                {"field": "Exports_A$b", "title": "Exports (A$ Billion)", "format": ".0f", "type": "quantitative"},
                {"field": "Imports_A$b", "title": "Imports (A$ Billion)", "format": ".0f", "type": "quantitative"}
              ]
            }
          },
          // Layer 4: Graticule (latitude/longitude grid lines)
          {
            "data": {"graticule": {"step": [30, 30]}},
            "mark": {"type": "geoshape", "stroke": "#cccccc", "strokeWidth": 0.3, "fill": null}
          }
        ],
        "config": {"view": {"stroke": null}}
      };
    }

    /* ========================================
       CREATE LINE CHART SPECIFICATION
       Generates Vega-Lite spec for the time series line chart
       
       Parameters:
       - tradeType: 'Exports' or 'Imports'
       - yearValue: Maximum year to display (filters data up to this year)
       
       Features:
       - Width: 850px (optimized to fit with right-side legend)
       - Height: 450px
       - Legend: Positioned on RIGHT side, vertical list of countries
       - Shows data from 2014 up to the SELECTED YEAR (synchronized with map)
       - Each country has a unique color
       - Interactive tooltips on hover
       ======================================== */
    function createLineChartSpec(tradeType, yearValue) {
      return {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "width": 850,
        "height": 450,
        "title": {
          "text": tradeType + " Trends for All Trading Partners (2014-" + yearValue + ")",
          "fontSize": 18,
          "fontWeight": "bold",
          "anchor": "middle"
        },
        "data": {"values": allTradeData},
        "transform": [
          // FILTER: Only show data up to the selected year
          {"filter": "datum.Year <= " + yearValue},
          // Calculate trade value based on selected type
          {"calculate": tradeType === 'Exports' ? "datum.Exports_A$b" : "datum.Imports_A$b", "as": "TradeValue"}
        ],
        "mark": {
          "type": "line",
          "point": true,  // Show data points on the line
          "strokeWidth": 2.5
        },
        "encoding": {
          // X-axis: Years from 2014 to selected year
          "x": {
            "field": "Year",
            "type": "quantitative",
            "title": "Year",
            "axis": {"grid": false, "tickCount": 11, "format": "d"},
            "scale": {"domain": [2014, 2024]}  // Keep full scale for consistency
          },
          // Y-axis: Trade values in AUD billions
          "y": {
            "field": "TradeValue",
            "type": "quantitative",
            "title": "Trade Value (A$ Billion)",
            "axis": {"grid": true},
            "scale": {"domain": [0, 220]}
          },
          // Color: Each country gets a unique color
          "color": {
            "field": "Country",
            "type": "nominal",
            "title": "Country",
            "scale": {
              "domain": ["China", "Japan", "South Korea", "United States of America", "India", "Taiwan", "Singapore", "United Kingdom", "New Zealand", "Thailand"],
              // Custom color palette for distinct visualization
              "range": ["#e74c3c", "#3498db", "#2ecc71", "#f39c12", "#9b59b6", "#1abc9c", "#e67e22", "#34495e", "#16a085", "#d35400"]
            },
            // LEGEND POSITION: Right side, vertical list
            "legend": {
              "orient": "right",
              "labelLimit": 200,
              "symbolSize": 80,
              "titleLimit": 100,
              "offset": 10
            }
          },
          // Tooltip: Shows country, year, and both export/import values
          "tooltip": [
            {"field": "Country", "type": "nominal", "title": "Country"},
            {"field": "Year", "type": "quantitative", "title": "Year"},
            {"field": "Exports_A$b", "type": "quantitative", "title": "Exports (A$ Billion)", "format": ".0f"},
            {"field": "Imports_A$b", "type": "quantitative", "title": "Imports (A$ Billion)", "format": ".0f"}
          ]
        },
        "config": {"view": {"stroke": null}}
      };
    }

    /* ========================================
       INITIAL RENDER
       Renders both visualizations with default settings
       - Year: 2024 (most recent)
       - Trade Type: Exports
       ======================================== */
    let currentYear = 2024;
    vegaEmbed('#export-map', createMapSpec('Exports', currentYear), {actions: false}).then(result => {
      mapView = result.view;
    });

    vegaEmbed('#trade-chart', createLineChartSpec('Exports', currentYear), {actions: false}).then(result => {
      chartView = result.view;
    });

    /* ========================================
       EVENT LISTENERS
       Handle user interactions with controls
       ======================================== */
    
    const yearSlider = document.getElementById('yearSlider');
    const yearDisplay = document.getElementById('yearDisplay');
    const tradeSelect = document.getElementById('tradeSelect');

    /* 
     * YEAR SLIDER EVENT
     * When user moves the slider:
     * 1. Update the displayed year number
     * 2. Re-render the MAP with new year's data
     * 3. Re-render the LINE CHART to show data up to selected year
     * 
     * SYNCHRONIZED: Both visualizations update together!
     */
    yearSlider.addEventListener('input', function() {
      const year = parseInt(this.value);
      currentYear = year;
      yearDisplay.textContent = year;
      
      // Re-render BOTH visualizations with selected year
      vegaEmbed('#export-map', createMapSpec(currentTradeType, year), {actions: false}).then(result => {
        mapView = result.view;
      });
      
      vegaEmbed('#trade-chart', createLineChartSpec(currentTradeType, year), {actions: false}).then(result => {
        chartView = result.view;
      });
    });

    /* 
     * TRADE DIRECTION SELECTOR EVENT
     * When user changes between Exports/Imports:
     * 1. Update current trade type
     * 2. Re-render BOTH visualizations with new color scheme
     *    - Exports: RED color scheme
     *    - Imports: BLUE color scheme
     * 3. Both charts update to show the selected trade direction
     * 4. Line chart filters to current selected year
     * 
     * SYNCHRONIZED: Both visualizations update together!
     */
    tradeSelect.addEventListener('change', function() {
      const tradeType = this.value;
      currentTradeType = tradeType;
      
      // Re-render both visualizations with new trade type AND current year
      vegaEmbed('#export-map', createMapSpec(tradeType, currentYear), {actions: false}).then(result => {
        mapView = result.view;
      });

      vegaEmbed('#trade-chart', createLineChartSpec(tradeType, currentYear), {actions: false}).then(result => {
        chartView = result.view;
      });
    });
  </script>
</body>
</html>